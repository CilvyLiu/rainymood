<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova's Pensieve - WebGL Ultra</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸº</text></svg>">
    <link rel="stylesheet" href="rain.css">
    <style>
        /* æ ¸å¿ƒå±‚çº§ï¼šWebGL åœ¨æœ€åº•å±‚ï¼ŒOverlay æä¾›æ°›å›´æ„Ÿ */
        #container {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: 1; /* æ”¹ä¸º 1ï¼Œç¡®ä¿åœ¨é»‘è‰² body ä¹‹ä¸Š */
            background-color: #000;
        }
        #overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: 2;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ° body */
            background: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.4) 100%);
        }
        /* UI å…ƒç´ å¿…é¡»åœ¨æœ€ä¸Šæ–¹ */
        .side-nav, .center-container, .bottom-bar {
            z-index: 100 !important;
        }
    </style>
</head>
<body onclick="initAudio()">

    <div id="container"></div>
    <div id="overlay"></div>

    <div class="side-nav">
        <a href="https://gringott.streamlit.app/" target="_blank" class="nav-item" title="å¤çµé˜">ğŸ¦</a>
        <a href="https://wwskygazer.streamlit.app/" target="_blank" class="nav-item" title="å¥‡å…½é¥²è‚²">ğŸ¾</a>
        <a href="https://newscil.streamlit.app/" target="_blank" class="nav-item" title="é¢„è¨€å®¶æ—¥æŠ¥">ğŸ“œ</a>
        <a href="https://skygazer111.streamlit.app/" target="_blank" class="nav-item" title="å åœè¯¾">ğŸ”®</a>
    </div>

    <div class="center-container">
        <div class="rule-card" id="mainRule">
            <h2>çœ‹æ¿çºªå¾‹</h2>
            <p>
                <b>å£¹ Â· æ·±æ½œ</b>ï¼šå…¥å†¥æƒ³ç›†ï¼Œå¦‚æ°´æ»´èå…¥æ·±æ½­ã€‚<br>
                <b>è´° Â· ç²¾å‡†</b>ï¼šé€»è¾‘å¦‚å†°æ™¶ç¢è£‚ï¼Œæ•°æ®çš†æœ‰å› æœã€‚<br>
                <b>å Â· éŸ§æ€§</b>ï¼šçºµä½¿é›¨å¹•é®çœ¼ï¼Œäº¦è¦æ”«å–è¶‹åŠ¿ã€‚<br>
                <b>è‚† Â· è¿›åŒ–</b>ï¼šæ—¥æ‹±ä¸€å’ï¼Œä»¥æ­¤èº«ç‚¼å°±ç ´å±€ä¹‹æ³•ã€‚
            </p>
        </div>
        <button class="magic-btn" onclick="toggleRules(event)">FOCUS MODE</button>
    </div>

    <div class="bottom-bar">
        <div id="clock">00:00:00</div>
        
        <div class="control-group">
            <label>VOL</label> 
            <input type="range" id="vol" min="0" max="1" step="0.05" value="0.5" oninput="sync()">
        </div>
        
        <select id="weatherSelect" onchange="changeWeather()">
            <option value="rain">ğŸŒ§ï¸ ç»†é›¨</option>
            <option value="storm">â›ˆï¸ æš´é›¨</option>
            <option value="drizzle">ğŸŒ¦ï¸ é˜µé›¨</option>
            <option value="sunny">â˜€ï¸ æ™´æœ—</option>
        </select>

        <select id="sceneSelect" onchange="changeScene(this.value)">
            <option value="pensive.png">ğŸº å†¥æƒ³ç›†</option>
            <option value="train.png">ğŸš‚ éœæ ¼æ²ƒèŒ¨</option>
            <option value="window.png">ğŸªŸ è½åœ°çª—</option>
            <option value="beach.png">ğŸ–ï¸ è´å£³å°å±‹</option>
            <option value="mountain.png">ğŸ”ï¸ é›ªå±±</option>
        </select>
        
        <button id="pbtn" onclick="toggleAudio(event)">â–¶</button>
    </div>

    <audio id="audio" loop src="0.m4a"></audio>

   <script src="rain.js"></script>
<script>
    const audio = document.getElementById('audio');
    const pbtn = document.getElementById('pbtn');

    // åªéœ€è¦ä¿ç•™ UI äº¤äº’é€»è¾‘ï¼Œæ ¸å¿ƒæ¸²æŸ“é€»è¾‘äº¤ç»™ rain.js
    window.initAudio = function() { 
        if(audio.paused) { 
            audio.play().catch(e => console.log("ç­‰å¾…äº¤äº’...")); 
            pbtn.innerText = "â¸"; 
        } 
    };

    // éŸ³é¢‘åŒæ­¥æ»‘åŠ¨æ¡
    function sync() { 
        audio.volume = document.getElementById('vol').value; 
    }

    // å¤©æ°”åˆ‡æ¢é€»è¾‘ï¼ˆå¯ä»¥ä¿ç•™åœ¨è¿™é‡Œï¼Œå› ä¸ºå®ƒç›´æ¥æ“ä½œ rainEngine çš„æ•°å€¼ï¼‰
    function changeWeather() {
        const weather = document.getElementById('weatherSelect').value;
        if(window.rainEngine && window.rainEngine.raindrops) {
            const config = {
                rain:    { chance: 0.3, minR: 15, maxR: 40 },
                storm:   { chance: 0.7, minR: 20, maxR: 50 },
                drizzle: { chance: 0.1, minR: 5,  maxR: 20 },
                sunny:   { chance: 0,   minR: 0,  maxR: 0 }
            };
            const opt = config[weather];
            const target = window.rainEngine.raindrops.options;
            target.rainChance = opt.chance;
            target.minR = opt.minR;
            target.maxR = opt.maxR;
            if(weather === 'sunny') window.rainEngine.raindrops.drops = [];
        }
    }

    // çœ‹æ¿æ˜¾éš
    function toggleRules(e) {
        e.stopPropagation();
        const card = document.getElementById('mainRule');
        const isHidden = getComputedStyle(card).display === 'none';
        card.style.display = isHidden ? 'block' : 'none';
        e.target.innerText = isHidden ? 'RELEASE' : 'FOCUS MODE';
    }

    // æ—¶é’Ÿ
    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('zh-CN', {hour12: false});
    }
    setInterval(updateClock, 1000);
    updateClock();
    sync();
</script>
</body>
</html>
